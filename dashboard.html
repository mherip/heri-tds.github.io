<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>PROKLIMASARI HIDROPONIK</title>
	<!-- base:css -->
	<link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
	<link rel="stylesheet" href="vendors/base/vendor.bundle.base.css">
	<!-- endinject -->
	<!-- plugin css for this page -->
	<!-- End plugin css for this page -->
	<!-- inject:css -->
	<link rel="stylesheet" href="css/style.css">
	<!-- endinject -->
	<link rel="shortcut icon" href="images/proklimasari-mini.png" />
	<style>
		/* The Modal (background) */
		.modal {
			display: none;
			/* Hidden by default */
			position: fixed;
			/* Stay in place */
			z-index: 1;
			/* Sit on top */
			padding-top: 100px;
			/* Location of the box */
			left: 0;
			top: 0;
			width: 100%;
			/* Full width */
			height: 100%;
			/* Full height */
			overflow: auto;
			/* Enable scroll if needed */
			background-color: rgb(0, 0, 0);
			/* Fallback color */
			background-color: rgba(0, 0, 0, 0.4);
			/* Black w/ opacity */
		}

		/* Modal Content */
		.modal-content {
			background-color: #fefefe;
			margin: auto;
			padding: 20px;
			border: 1px solid #888;
			width: 80%;
		}
	</style>
</head>

<body>
	<div class="container-scroller">
		<!-- LOGO DIATAS -->
		<div class="horizontal-menu">
			<nav class="navbar top-navbar col-lg-12 col-12 p-10">
				<div class="container-fluid">
					<div class="navbar-menu-wrapper d-flex">
						<div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-between">
							<a class="brand-logo" href="index.html"><img src="images/proklimasari.png"
									alt="logo" width="300px" height="100%"/></a>
							<!-- <a class="navbar-brand brand-logo-mini" href="index.html"><img src="images/proklimasari-mini.png"
									alt="logo" /></a> -->
						</div>
					</div>
					<button class="text-center btn btn-danger text-white" style="margin: 10px;" id="logout"> Logout</button>
				</div>
			</nav>
		</div>
		<!-- LOGO DIATAS -->
		<div class="container-fluid page-body-wrapper">
			<div class="main-panel">
				<div class="content-wrapper">
					<div id='kondisi-ppm'></div>
					<div class="row">

						<!-- BAROMETER PPM -->
						<div class="col-sm-8 flex-column d-flex stretch-card">
							<div class="row">
								<div class="col-sm-12 grid-margin d-flex stretch-card">
									<div class="card">
										<div class="card-body">
											<div class="d-lg-flex align-items-center justify-content-between mb-4">
												<h4 class="card-title">LEVEL PPM</h4>
												<!-- <p class="text-dark"></p> -->
											</div>
											<div id="gage-parent" class="product-order-wrap padding-reduced">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- END OF BAROMETER PPM -->
						<!-- 3 KOTAK KANAN -->
						<div class="col-sm-4 flex-column d-flex stretch-card">
							<div class="row flex-grow">
								<div class="col-sm-12 grid-margin stretch-card">
									<div class="card sale-visit-statistics-border">
										<div class="card-body">
											<h4 class="card-title mb-2">POMPA AIR</h4>
											<h2 id="pump-status" class="text-dark mb-2 font-weight-bold"></h2>
											<small class="text-muted">kondisi pompa air</small>
										</div>
									</div>
								</div>
								<div class="col-sm-12 grid-margin stretch-card">
									<div class="card sale-diffrence-border">
										<div class="card-body">
											<h4 class="card-title mb-2">MAXIMUM PPM</h4>
											<h2 id="max-ppm" class="text-dark mb-2 font-weight-bold"></h2>
											<button type="button" id="myBtn" data-title="max-ppm"
												class="btn btn-primary font-weight-normal">Edit</button>
										</div>
									</div>
								</div>
								<div class="col-sm-12 grid-margin stretch-card">
									<div class="card sale-visit-statistics-border">
										<div class="card-body">
											<h4 class="card-title mb-2">INPUT SET POINT PPM</h4>
											<h2 id="min-ppm" class="text-dark mb-2 font-weight-bold"></h2>
											<button type="button" id="myBtnMin" data-title="min-ppm"
												class="btn btn-success font-weight-normal">Edit</button>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- END OF 3 KOTAK KANAN -->
						<!-- MODAL MODAL -->
						<div id="myModal" class="modal">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="title-modal">MAXIMUM PPM</h5>
								</div>
								<div class="modal-body">
									<div class="form-group">
										<label>Input Maximum PPM</label>
										<input type="number" id="inptmaxppm" class="form-control"
											placeholder="Input maximum PPM di sini">
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary close"
										data-dismiss="modal">Close</button>
									<button type="button" id="btnAddMaxPPM" class="btn btn-primary">Save
										changes</button>
								</div>
							</div>
						</div>

						<!-- MODAL SET POINT -->
						<div id="myModalMin" class="modal">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="title-modal">Set Point PPM</h5>
								</div>
								<div class="modal-body">
									<div class="form-group">
										<label>Input Set Point PPM</label>
										<input type="number" id="inptminppm" class=" form-control"
											placeholder="Input Minimum PPM di sini">
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary close"
										data-dismiss="modal">Close</button>
									<button type="button" id="btnAddMinPPM" class="btn btn-primary">Save
										changes</button>
								</div>
							</div>
						</div>

						<!-- END OF MODAL MODAL -->

					</div>
					<!-- KOTAK PALING ATAS -->
				</div>
				<!-- content-wrapper ends -->
				<!-- partial:partials/_footer.html -->
				<!-- partial -->
			</div>
			<!-- main-panel ends -->
		</div>
		<!-- page-body-wrapper ends -->
	</div>
	<!-- container-scroller -->
	<!-- base:js -->
	<script src="vendors/base/vendor.bundle.base.js"></script>
	<!-- endinject -->
	<!-- Plugin js for this page-->
	<!-- End plugin js for this page-->
	<!-- inject:js -->
	<script src="js/template.js"></script>
	<!-- endinject -->
	<!-- plugin js for this page -->
	<!-- End plugin js for this page -->
	<script src="vendors/chart.js/Chart.min.js"></script>
	<script src="vendors/progressbar.js/progressbar.min.js"></script>
	<script src="vendors/chartjs-plugin-datalabels/chartjs-plugin-datalabels.js"></script>
	<script src="vendors/justgage/raphael-2.1.4.min.js"></script>
	<script src="vendors/justgage/justgage.js"></script>
	<script src="js/jquery.cookie.js" type="text/javascript"></script>
	<!-- Custom js for this page-->
	<script src="js/dashboard.js"></script>

	<!-- End custom js for this page-->
	<script type="module">
		// Get the modal
		var modal = document.getElementById("myModal");
		var modalMin = document.getElementById("myModalMin");

		// Get the button that opens the modal
		var btn = document.getElementById("myBtn");
		var btnMin = document.getElementById("myBtnMin");

		// Get the <span> element that closes the modal
		var span = document.getElementsByClassName("close")[0];
		var spanMin = document.getElementsByClassName("close")[1];

		// When the user clicks the button, open the modal 
		btn.onclick = function () {
			modal.style.display = "block";
		}

		btnMin.onclick = function () {
			modalMin.style.display = "block";
		}

		// When the user clicks on <span> (x), close the modal
		span.onclick = function () {
			modal.style.display = "none";
		}
		spanMin.onclick = function () {
			modalMin.style.display = "none";
		}

		// When the user clicks anywhere outside of the modal, close it
		window.onclick = function (event) {
			if (event.target == modal) {
				modal.style.display = "none";
			} else if (event.target == modalMin) {
				modalMin.style.display = "none";
			}
		}
		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js";
		import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-analytics.js";
		import { getDatabase, onValue, ref, set } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-database.js"
		// TODO: Add SDKs for Firebase products that you want to use
		// https://firebase.google.com/docs/web/setup#available-libraries

		// Your web app's Firebase configuration
		// For Firebase JS SDK v7.20.0 and later, measurementId is optional
		const firebaseConfig = {
			apiKey: "AIzaSyDKcOV8lOojlfBrPJQlgVV_fIrGHSFeTbY",
			authDomain: "skripsi-tds.firebaseapp.com",
			databaseURL: "https://skripsi-tds-default-rtdb.firebaseio.com",
			projectId: "skripsi-tds",
			storageBucket: "skripsi-tds.appspot.com",
			messagingSenderId: "642338782269",
			appId: "1:642338782269:web:d449f1f8dee5a6083abe54"
};


		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const analytics = getAnalytics(app);
		const db = getDatabase(app);


		// document.getElementById("click").onclick = function () {
		// 	// 	let ppm = document.getElementById("ppm").value;
		// 	// 	let status = document.getElementById("status").value;
		// 	// 	let isi = document.getElementById("isi").value;

		// 	set(ref(db, 'data/'), {
		// 		PPM: ppm,
		// 		status: status,
		// 		total: isi
		// 	});
		// };
		document.getElementById("btnAddMaxPPM").onclick = function () {
			var maxPpm = document.getElementById('inptmaxppm').value
			set(ref(db, 'data/max'), parseInt(maxPpm));
			modal.style.display = "none";
		};

		document.getElementById("btnAddMinPPM").onclick = function () {
			var minPpm = document.getElementById('inptminppm').value
			set(ref(db, 'data/min'), parseInt(minPpm));
			modalMin.style.display = "none";
		};

		const starCountRef = ref(db, 'data/');
		// var myRef = new Firebase('https://skripsi-tds-default-rtdb.firebaseio.com');

		// data = snapshot.val();
		var ppm;
		onValue(starCountRef, (snapshot) => {
			const data = snapshot.val();
			// console.log(data);

			// init variabel warna kondisi
			var warna;
			
			ppm = data.PPM
			if(data.kondisi.toLowerCase() == 'cukup'){
				var warna = 'success';
			}else{
				warna = 'danger'
			}
		
			// var min = data.min
			// var max = data.max
			document.getElementById("max-ppm").innerHTML = data.max + " PPM"
			document.getElementById("kondisi-ppm").innerHTML = `<div class='alert alert-${warna} text-center'> <strong><h3>Kondisi Nutrisi ${data.kondisi}</h3></strong></div>`
			document.getElementById("min-ppm").innerHTML = data.min + " PPM"
			document.getElementById("pump-status").innerHTML = data.status ? "HIDUP" : "TIDAK HIDUP"
			document.getElementById("gage-parent").innerHTML = "<div id='productorder-gage' class='gauge productorder-gage'></div>"
			var productorderGage = new JustGage({
				id: "productorder-gage",
				value: data.PPM,
				min: 0,
				max: data.max,
				hideMinMax: false,
				symbol: "PPM",
				label: "Level PPM ",
				valueFontColor: "#001737",
				labelFontColor: "#001737",
				gaugeWidthScale: 0.3,
				counter: true,
				relativeGaugeSize: true,
				gaugeColor: "#f0f0f0",
				levelColors: ["#00ff2a", "#fa424a"],
			});
		}, {
			onlyOnce: false
		});

	</script>
	 <script>
		if (sessionStorage.getItem("user") == null) {
		  window.location.replace("index.html");
		}
		const logoutbutton = document.getElementById("logout");
		logoutbutton.addEventListener("click", function () {
		  sessionStorage.removeItem("user");
		  window.location.replace("index.html");
		});
	  </script>
</body>

</html>